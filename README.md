# üöÄ Sistema de Email Personalizado con CRUD

Sistema h√≠brido de emails que permite procesamiento de comandos CRUD via email con dos modalidades: servidor tecnoweb y servidor independiente.

## üë®‚Äçüíª Desarrollador
- **Nombre**: Marco David Toledo
- **Email**: marcodavidtoledo@gmail.com

## üîß Configuraci√≥n

### Base de Datos Local
```
Host: localhost
Puerto: 5432
Base de datos: EcommerceTool (debe existir previamente)
Usuario: postgres
Password: postgres
```

### Configuraci√≥n Tecnoweb (Compatibilidad)
```
Host: mail.tecnoweb.org.bo
Puerto: 5432
Base de datos: db_grupo21sc
Usuario: grupo21sc
Password: grup021grup021*
```

## üì¶ Instalaci√≥n

### 1. Prerequisitos
- Java 8 o superior
- PostgreSQL
- Base de datos `EcommerceTool` creada

### 2. Inicializar Base de Datos
```bash
# Conectar a PostgreSQL como postgres
psql -U postgres -d EcommerceTool -f sql/init_database.sql
```

### 3. Compilar
```bash
# Compilar con dependencias JavaMail
javac -cp "lib/*:src/main/java" LanzadorPrincipal.java
```

## üéØ Modos de Funcionamiento

### üöÄ Lanzador Principal
```bash
java -cp "lib/*:src/main/java:." LanzadorPrincipal
```

#### Opciones Disponibles:

**üîß Versi√≥n Tecnoweb (Original)**
1. **EmailApp Tecnoweb** - Procesa emails via POP3 desde mail.tecnoweb.org.bo

**üÜï Versi√≥n Independiente (Nueva)**
2. **Monitor Gmail con Comandos** - Procesa comandos CRUD via email
3. **Servidor HTTP Email** - Interfaz web + API REST
4. **Sistema Completo** - Monitor Gmail + Servidor HTTP

**üõ†Ô∏è Herramientas**
5. **Test EmailApp Independiente** - Prueba procesamiento de comandos
6. **Informaci√≥n del Sistema** - Muestra configuraci√≥n actual

## üìß Comandos Disponibles via Email

### ‚úÖ Implementados
- `usuario get` - Lista todos los usuarios
- `usuario get <id>` - Obtiene usuario por ID
- `help` - Muestra comandos disponibles

### ‚è≥ En desarrollo
- `usuario add <params>` - Crear usuario
- `usuario modify <params>` - Modificar usuario
- `usuario delete <id>` - Eliminar usuario
- `evento`, `reserva`, `pago`, etc.

## üåê Servidor HTTP

### Endpoints
- **GET /** - Interfaz web
- **POST /send-email** - Enviar email via API

### Uso con ngrok
```bash
# Iniciar ngrok (opcional para acceso p√∫blico)
ngrok http 8080
```

### URL de Ejemplo
```
Local: http://localhost:8080
Ngrok: https://340c-181-188-162-193.ngrok-free.app
```

## üìä Estructura del Proyecto

```
src/main/java/
‚îú‚îÄ‚îÄ com/mycompany/parcial1/tecnoweb/
‚îÇ   ‚îú‚îÄ‚îÄ EmailApp.java                    # Versi√≥n tecnoweb
‚îÇ   ‚îú‚îÄ‚îÄ EmailAppIndependiente.java       # Versi√≥n independiente
‚îÇ   ‚îî‚îÄ‚îÄ LanzadorPrincipal.java          # Launcher principal
‚îú‚îÄ‚îÄ servidor/
‚îÇ   ‚îú‚îÄ‚îÄ GmailMonitorComandos.java       # Monitor h√≠brido
‚îÇ   ‚îú‚îÄ‚îÄ HTTPEmailServer.java            # Servidor HTTP
‚îÇ   ‚îî‚îÄ‚îÄ GmailRelay.java                 # Relay Gmail
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ DUsuario.java                   # DAO usuarios
‚îú‚îÄ‚îÄ negocio/
‚îÇ   ‚îî‚îÄ‚îÄ NUsuario.java                   # L√≥gica de negocio
‚îî‚îÄ‚îÄ postgresConecction/
    ‚îî‚îÄ‚îÄ DBConnection.java               # Configuraci√≥n DB

sql/
‚îî‚îÄ‚îÄ init_database.sql                   # Script de inicializaci√≥n

lib/
‚îú‚îÄ‚îÄ mail-1.5.0-b01.jar                 # JavaMail API
‚îî‚îÄ‚îÄ activation-1.1.1.jar               # Activation framework
```

## üîÑ Diferencias entre Versiones

### üìß Versi√≥n Tecnoweb
- ‚úÖ Usa POP3 para recibir emails
- ‚úÖ Compatible con servidor original
- ‚ö†Ô∏è Dependiente de disponibilidad de tecnoweb.org.bo
- üóÑÔ∏è Base de datos: db_grupo21sc en mail.tecnoweb.org.bo

### üÜï Versi√≥n Independiente
- ‚úÖ Usa Gmail IMAP para recibir emails
- ‚úÖ Completamente independiente
- ‚úÖ Procesamiento CRUD via email
- ‚úÖ Servidor HTTP con interfaz web
- ‚úÖ API REST para aplicaciones
- ‚úÖ Respuestas autom√°ticas personalizadas
- üóÑÔ∏è Base de datos: EcommerceTool en localhost

## üéØ Uso R√°pido

### 1. Monitor de Emails con Comandos
```bash
java -cp "lib/*:src/main/java" servidor.GmailMonitorComandos
```

### 2. Servidor HTTP
```bash
java -cp "lib/*:src/main/java" servidor.HTTPEmailServer
```

### 3. Test de Comandos
```bash
java -cp "lib/*:src/main/java" com.mycompany.parcial1.tecnoweb.EmailAppIndependiente
```

## üìù Ejemplos de Comandos via Email

### Enviar email a: marcodavidtoledo@gmail.com

**Asunto**: `usuario get`
**Contenido**: `Quiero ver todos los usuarios`

**Asunto**: `usuario get 1`
**Contenido**: `Mostrar usuario con ID 1`

**Asunto**: `help`
**Contenido**: `Necesito ayuda con los comandos`

## üîß Soluci√≥n de Problemas

### Error de Conexi√≥n a Base de Datos
1. Verificar que PostgreSQL est√© ejecut√°ndose
2. Verificar que la base de datos `EcommerceTool` exista
3. Verificar credenciales en `DBConnection.java`

### Error de Gmail IMAP
1. Verificar conexi√≥n a internet
2. Verificar credenciales de Gmail
3. Verificar configuraci√≥n de "Apps menos seguras" en Gmail

### Error de Compilaci√≥n
1. Verificar que los JARs est√©n en la carpeta `lib/`
2. Verificar versi√≥n de Java (m√≠nimo Java 8)

## üåü Caracter√≠sticas Destacadas

- ‚úÖ **Dual Mode**: Tecnoweb + Independiente
- ‚úÖ **Email Processing**: Comandos CRUD via email
- ‚úÖ **HTTP API**: Interfaz web + REST endpoints
- ‚úÖ **Real-time Monitoring**: Detecci√≥n autom√°tica de emails
- ‚úÖ **Auto Response**: Respuestas autom√°ticas personalizadas
- ‚úÖ **Database Integration**: PostgreSQL local + remoto
- ‚úÖ **Error Handling**: Manejo robusto de errores
- ‚úÖ **Gmail Integration**: SMTP/IMAP con Gmail
- ‚úÖ **Ngrok Support**: Acceso p√∫blico via t√∫neles

## üìû Soporte

Para soporte o consultas:
- **Email**: marcodavidtoledo@gmail.com
- **Prueba del servidor**: https://340c-181-188-162-193.ngrok-free.app

# üìß SISTEMA DE EMAIL CON COMANDOS v2.0

**Sistema completo de manejo de emails que permite ejecutar comandos CRUD enviando emails. Nueva funcionalidad: responde a emails con comandos en el contenido.**

---

## üöÄ **NOVEDADES v2.0**

### ‚úÖ **PROBLEMA SOLUCIONADO: Respuestas a Emails**

**Antes:** Solo detectaba comandos en el asunto del email
**Ahora:** Detecta comandos tanto en el asunto COMO en el contenido

**Ejemplo de uso:**
1. El sistema te env√≠a un email con lista de usuarios
2. T√∫ respondes a ese email escribiendo "usuario get" en el contenido
3. El sistema detecta el comando y te responde autom√°ticamente

### üßπ **LIMPIEZA Y ORGANIZACI√ìN**

- ‚úÖ Eliminados archivos de test no utilizados
- ‚úÖ Casos de uso no implementados claramente marcados
- ‚úÖ Lanzador principal reorganizado
- ‚úÖ Documentaci√≥n actualizada

---

## üéØ **INICIO R√ÅPIDO**

### **1. Compilar el proyecto**
```bash
javac -cp "lib/*:src/main/java" LanzadorPrincipal.java
```

### **2. Ejecutar sistema**
```bash
java -cp "lib/*:src/main/java:." LanzadorPrincipal
```

### **3. Seleccionar Monitor Gmail (opci√≥n 1)**

### **4. Enviar comandos por email**
- **Email destino:** `marcodavidtoledo@gmail.com`
- **Comando en asunto:** `usuario get`
- **O comando en contenido:** Responde a cualquier email escribiendo el comando

---

## üìù **COMANDOS DISPONIBLES**

### üîì **Sin Autenticaci√≥n Requerida**
```
registrar Juan P√©rez 123456789 masculino
registrar Mar√≠a Gonz√°lez 987654321 femenino
help
```

### üîê **Con Autenticaci√≥n (registro previo)**
```
usuario get
usuario get 5
producto get
producto get 3
categoria get
categoria get 2
cliente get
cliente get 1
tipo_pago get
tipo_pago get 1
```

---

## üèóÔ∏è **ARQUITECTURA DEL SISTEMA**

```
üì¶ SISTEMA DE EMAIL
‚îú‚îÄ‚îÄ üöÄ LanzadorPrincipal.java          - Punto de entrada principal
‚îú‚îÄ‚îÄ ü§ñ GmailMonitorComandos.java       - Monitor IMAP en tiempo real
‚îú‚îÄ‚îÄ üìß EmailAppIndependiente.java      - Procesador de comandos
‚îú‚îÄ‚îÄ üì§ GmailRelay.java                 - Enviador de emails SMTP
‚îú‚îÄ‚îÄ üé® HtmlRes.java                    - Generador de HTML moderno
‚îú‚îÄ‚îÄ üóÑÔ∏è DUsuario.java                   - Acceso a datos de usuarios
‚îú‚îÄ‚îÄ üóÑÔ∏è DProducto.java                  - Acceso a datos de productos
‚îú‚îÄ‚îÄ üóÑÔ∏è DCategoria.java                 - Acceso a datos de categor√≠as
‚îú‚îÄ‚îÄ üóÑÔ∏è DCliente.java                   - Acceso a datos de clientes
‚îî‚îÄ‚îÄ üóÑÔ∏è DTipoPago.java                  - Acceso a datos de tipos de pago
```

### **üîÑ Flujo de Procesamiento v2.0**

```mermaid
graph TD
    A[üìß Email Recibido] --> B[üîç Monitor IMAP]
    B --> C{üéØ ¬øComando en Asunto?}
    C -->|S√≠| D[‚úÖ Extraer del Asunto]
    C -->|No| E{üîç ¬øComando en Contenido?}
    E -->|S√≠| F[üßπ Limpiar HTML/Quotes]
    E -->|No| G[‚ùå No Es Comando]
    F --> H[‚úÖ Extraer del Contenido]
    D --> I[ü§ñ EmailAppIndependiente]
    H --> I
    I --> J[üíæ Base de Datos]
    J --> K[üé® HTML Response]
    G --> L[üìß Respuesta Autom√°tica]
    K --> M[üì§ Enviar Respuesta]
    L --> M
```

---

## üîß **INSTALACI√ìN Y CONFIGURACI√ìN**

### **Prerequisitos**
- Java 8+
- PostgreSQL 12+
- Maven (opcional)

### **1. Base de Datos**
```sql
-- Crear base de datos
CREATE DATABASE EcommerceTool;

-- Tabla de usuarios (principal)
CREATE TABLE usuario (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    telefono VARCHAR(20) NOT NULL,
    genero VARCHAR(20) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insertar usuario admin
INSERT INTO usuario (nombre, apellido, telefono, genero, email) 
VALUES ('Admin', 'Sistema', '123456789', 'masculino', 'admin@sistema.com');
```

### **2. Configuraci√≥n Gmail**
En `servidor/GmailMonitorComandos.java`:
```java
private static final String GMAIL_USERNAME = "tu-email@gmail.com";
private static final String GMAIL_APP_PASSWORD = "tu-app-password";
```

### **3. Configuraci√≥n Base de Datos**
En `postgresConecction/DBConnection.java`:
```java
public static String database = "EcommerceTool";
public static String server = "127.0.0.1";
public static String user = "postgres";
public static String password = "tu-password";
```

---

## üìñ **C√ìMO USAR**

### **M√©todo 1: Comando en Asunto**
1. Env√≠a email a: `marcodavidtoledo@gmail.com`
2. Asunto: `usuario get`
3. Contenido: (cualquier cosa)

### **M√©todo 2: Comando en Contenido (NUEVO v2.0)**
1. Responde a cualquier email del sistema
2. Escribe el comando en el contenido: `usuario get`
3. El sistema detecta y procesa autom√°ticamente

### **Validaciones de Registro**
```
‚úÖ V√ÅLIDO:   registrar Juan P√©rez 123456789 masculino
‚úÖ V√ÅLIDO:   registrar Mar√≠a Gonz√°lez 987654321 f
‚ùå INV√ÅLIDO: registrar Juan (faltan par√°metros)
‚ùå INV√ÅLIDO: registrar Juan P√©rez abc masculino (tel√©fono inv√°lido)
```

---

## üé® **EJEMPLOS DE RESPUESTAS**

### **‚úÖ Respuesta de √âxito**
```html
üéâ ¬°Registro Exitoso!
¬°Bienvenido Juan P√©rez!
Email registrado: usuario@example.com
```

### **‚ùå Respuesta de Error**
```html
‚ùå Error en Registro
Comando: registrar Juan
Error: Faltan par√°metros (1 de 4)
Correcci√≥n: registrar Juan P√©rez 123456789 masculino
```

### **üìä Respuesta con Tabla**
```html
üìä Lista de Usuarios
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ID  ‚îÇ Nombre         ‚îÇ Email               ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 1   ‚îÇ Juan P√©rez     ‚îÇ juan@example.com    ‚îÇ
‚îÇ 2   ‚îÇ Mar√≠a Gonz√°lez ‚îÇ maria@example.com   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üß™ **TESTING Y DESARROLLO**

### **Test Local (Sin Emails Reales)**
```bash
java -cp postgresql-42.7.4.jar:target/classes LanzadorPrincipal
# Seleccionar opci√≥n 2: Test EmailApp
```

### **Test de Comandos**
```java
EmailAppIndependiente app = new EmailAppIndependiente();
app.processEmailCommand("test@test.com", "usuario get", "contenido");
```

---

## üîç **CARACTER√çSTICAS T√âCNICAS**

### **üéØ Detecci√≥n de Comandos v2.0**
- ‚úÖ **Asunto del email** (tradicional)
- ‚úÖ **Contenido del email** (nuevo)
- ‚úÖ **Limpieza autom√°tica** de HTML y texto citado
- ‚úÖ **Decodificaci√≥n** de quoted-printable
- ‚úÖ **Filtrado** de l√≠neas de respuesta/quote

### **üõ°Ô∏è Validaciones Implementadas**
- ‚úÖ **Registro:** 4 par√°metros exactos
- ‚úÖ **Tel√©fono:** Solo n√∫meros, m√≠nimo 6 d√≠gitos
- ‚úÖ **G√©nero:** masculino/femenino/m/f
- ‚úÖ **Email:** Inclusi√≥n autom√°tica del remitente

### **üé® Generaci√≥n HTML**
- ‚úÖ **CSS moderno** con gradientes
- ‚úÖ **Responsive design**
- ‚úÖ **Tablas profesionales**
- ‚úÖ **Mensajes de error con sugerencias**

---

## üö® **SOLUCI√ìN DE PROBLEMAS**

### **‚ùå "No se encontraron comandos v√°lidos"**
**Causa:** El comando no est√° en la lista de comandos soportados
**Soluci√≥n:** Verificar comandos disponibles con `help`

### **‚ùå "Error de base de datos"**
**Causa:** PostgreSQL no est√° ejecut√°ndose o configuraci√≥n incorrecta
**Soluci√≥n:** 
```bash
sudo service postgresql start
psql -U postgres -d EcommerceTool -c "SELECT 1;"
```

### **‚ùå "Authentication failed"**
**Causa:** Credenciales de Gmail incorrectas
**Soluci√≥n:** Verificar app password en configuraci√≥n

### **‚ùå "Comando encontrado pero no responde"**
**Causa:** Error en procesamiento interno
**Soluci√≥n:** Revisar logs de consola para detalles

---

## üìã **CASOS DE USO**

### **‚úÖ IMPLEMENTADOS Y FUNCIONALES**
- **Registro de usuarios** (sin autenticaci√≥n)
- **Consulta de usuarios** (con autenticaci√≥n)
- **Consulta de productos** (con autenticaci√≥n)
- **Consulta de categor√≠as** (con autenticaci√≥n)
- **Consulta de clientes** (con autenticaci√≥n)
- **Consulta de tipos de pago** (con autenticaci√≥n)
- **Sistema de ayuda**

### **‚ùå NO IMPLEMENTADOS (Responden "No Disponible")**
- Eventos, Reservas, Pagos
- Proveedores, Promociones
- Patrocinadores, Patrocinios
- Roles, Servicios
- Detalles de Eventos

---

## üîÆ **ROADMAP FUTURO**

### **v2.1 - Pr√≥ximas Mejoras**
- üîê **Autenticaci√≥n por tokens** para mayor seguridad
- üìä **Dashboard web** para monitoreo
- üîç **B√∫squeda avanzada** en base de datos
- üì± **Notificaciones push** para administradores

### **v3.0 - Expansi√≥n**
- üåê **API REST** complementaria
- üìà **M√©tricas y analytics** de uso
- üîÑ **Sync con otros sistemas** de email
- ü§ñ **IA para procesamiento** de lenguaje natural

---

## üë• **CR√âDITOS**

- **üßë‚Äçüíª Desarrollador:** Marco David Toledo
- **üìß Email:** marcodavidtoledo@gmail.com
- **üóìÔ∏è Versi√≥n:** 2.0 - Diciembre 2024
- **üéØ Prop√≥sito:** Sistema CRUD via Email con detecci√≥n avanzada

---

## üìÑ **LICENCIA**

```
MIT License - Uso libre para proyectos educativos y comerciales
```

---

**üéâ ¬°SISTEMA LISTO PARA USAR!** 

Para comenzar: `java -cp postgresql-42.7.4.jar:target/classes LanzadorPrincipal`
